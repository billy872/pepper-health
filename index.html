<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow">
    <title>Pepper Health Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        cream: '#fafafa',
                        warmgray: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#d4d4d4' },
                        sage: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#a3a3a3', 400: '#404040', 500: '#262626' },
                        amber: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#a3a3a3', 400: '#525252', 500: '#262626' },
                        coral: { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444' }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        
        /* Light mode */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #111111;
            --text-secondary: #555555;
            --text-muted: #888888;
            --border: #e0e0e0;
            --accent: #111111;
            --accent-light: #f0f0f0;
            --normal: #333333;
            --normal-bg: #f0f0f0;
            --warning: #f59e0b;
            --warning-bg: #fef3c7;
            --danger: #dc2626;
            --danger-bg: #fee2e2;
        }
        
        /* Dark mode */
        .dark {
            --bg-primary: #0a0a0a;
            --bg-secondary: #171717;
            --bg-card: #1a1a1a;
            --text-primary: #fafafa;
            --text-secondary: #a3a3a3;
            --text-muted: #737373;
            --border: #262626;
            --accent: #fafafa;
            --accent-light: #262626;
            --normal: #e5e5e5;
            --normal-bg: #262626;
            --warning: #fbbf24;
            --warning-bg: #422006;
            --danger: #ef4444;
            --danger-bg: #450a0a;
        }
        
        body { background: var(--bg-primary); color: var(--text-primary); transition: all 0.3s; }
        .card { background: var(--bg-card); border: 1px solid var(--border); }
        .card-shadow { box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 4px 12px rgba(0,0,0,0.04); }
        .chart-container { position: relative; height: 160px; }
        @media (min-width: 640px) { .chart-container { height: 200px; } }
        
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-normal { background: var(--normal-bg); color: var(--normal); }
        .status-warning { background: var(--warning-bg); color: var(--warning); }
        .status-danger { background: var(--danger-bg); color: var(--danger); }
        
        .interpretation-card {
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--bg-secondary) 100%);
            border-left: 3px solid var(--accent);
        }
        
        input, textarea, select {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }
        
        /* Prayer Section Styles */
        .prayers-section {
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .prayers-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
            animation: shimmer 15s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30%, 30%); }
        }

        .prayer-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: float 6s ease-in-out infinite;
        }

        .prayer-card:nth-child(2) { animation-delay: -1s; }
        .prayer-card:nth-child(3) { animation-delay: -2s; }
        .prayer-card:nth-child(4) { animation-delay: -3s; }
        .prayer-card:nth-child(5) { animation-delay: -4s; }
        .prayer-card:nth-child(6) { animation-delay: -5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-4px); }
        }

        .prayer-card:hover {
            transform: scale(1.02) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .prayer-heart {
            animation: pulse-heart 2s ease-in-out infinite;
        }

        @keyframes pulse-heart {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.15); opacity: 1; }
        }

        .location-dot {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            position: relative;
        }
        
        .location-dot::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--accent);
            animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping {
            75%, 100% { transform: scale(2.5); opacity: 0; }
        }

        .globe-icon {
            animation: slow-spin 30s linear infinite;
        }

        @keyframes slow-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .prayer-carousel {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding: 8px 0;
        }

        .prayer-carousel::-webkit-scrollbar { display: none; }
        .prayer-carousel > div { scroll-snap-align: start; }

        .dark .prayers-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
        }

        .dark .prayer-card {
            background: #1e1e1e;
            border-color: #333;
        }
        
        /* Dark mode for filter buttons */
        .dark .filter-btn {
            border: 1px solid #333;
        }
        
        /* Dark mode for inputs */
        .dark input, .dark textarea, .dark select {
            background: #1a1a1a;
            border-color: #333;
            color: #fafafa;
        }
        
        /* Dark mode for interpretation card */
        .dark .interpretation-card {
            background: linear-gradient(135deg, #262626 0%, #1a1a1a 100%);
            border-left-color: #fafafa;
        }
        
        /* Dark mode for section dividers */
        .dark .bg-gray-100 {
            background: #262626 !important;
        }
        
        .dark .bg-gray-50 {
            background: #1a1a1a !important;
        }
        
        /* News Ticker Animation */
        .news-scroll {
            animation: scrollNews 20s linear infinite;
        }
        
        .news-scroll:hover {
            animation-play-state: paused;
        }
        
        @keyframes scrollNews {
            0% { transform: translateY(0); }
            20% { transform: translateY(0); }
            25% { transform: translateY(-80px); }
            45% { transform: translateY(-80px); }
            50% { transform: translateY(-160px); }
            70% { transform: translateY(-160px); }
            75% { transform: translateY(-240px); }
            95% { transform: translateY(-240px); }
            100% { transform: translateY(0); }
        }
        
        .news-item {
            height: 80px;
            display: flex;
            align-items: center;
        }
        
        /* Prayer card enhanced animations */
        .prayer-card {
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .prayer-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
            transform: rotate(45deg);
            animation: cardShine 8s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes cardShine {
            0%, 100% { transform: rotate(45deg) translateX(-150%); }
            50% { transform: rotate(45deg) translateX(150%); }
        }
        
        .prayer-avatar {
            object-fit: cover;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .flag-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            font-size: 12px;
            background: var(--bg-card);
            border-radius: 50%;
            padding: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .avatar-container {
            position: relative;
            flex-shrink: 0;
        }
        
        .avatar-placeholder {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Hover popup for prayer cards */
        .prayer-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 320px;
            text-align: center;
        }
        
        .prayer-popup.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .prayer-popup-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .prayer-popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .prayer-popup-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--border);
            margin: 0 auto 16px;
            display: block;
        }
        
        .prayer-popup-initials {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            margin: 0 auto 16px;
        }
        
        .prayer-popup-flag {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .btn-primary {
            background: var(--accent);
            color: var(--bg-primary);
        }
        .btn-primary:hover { opacity: 0.9; }
        
        .dark .btn-primary {
            background: #fafafa;
            color: #0a0a0a;
        }
        
        /* Dark mode fixes for status badges */
        .dark .status-normal {
            background: #262626;
            color: #e5e5e5;
        }
        .dark .status-warning {
            background: #422006;
            color: #fbbf24;
        }
        .dark .status-danger {
            background: #450a0a;
            color: #f87171;
        }
        
        /* Dark mode for cards */
        .dark .card {
            background: #1a1a1a;
            border-color: #333;
        }
        
        .nav-gradient {
            background: #111111;
        }
        .dark .nav-gradient {
            background: #0a0a0a;
            border-bottom: 1px solid var(--border);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Top Header (Mobile Minimal) -->
    <header class="nav-gradient text-white sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <img src="pepper.jpg" alt="Pepper" class="w-14 h-14 rounded-full object-cover border-2 border-white/30">
                    <div>
                        <h1 class="font-bold text-base sm:text-lg">Pepper</h1>
                        <p class="text-[10px] sm:text-xs text-white/70">Female ‚Ä¢ 7 yrs 2 mo</p>
                    </div>
                </div>
                <button onclick="toggleDarkMode()" id="dark-toggle" class="p-2 rounded-lg hover:bg-white/10" title="Toggle dark mode">
                    <span id="dark-icon">üåô</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Bottom Navigation (Mobile-First) -->
    <nav class="fixed bottom-0 left-0 right-0 z-50 sm:relative sm:bottom-auto" style="background: var(--bg-card); border-top: 1px solid var(--border);">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-around items-center py-2 sm:py-3 sm:justify-center sm:gap-2">
                <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-btn flex flex-col sm:flex-row items-center gap-1 px-5 py-2 rounded-xl text-xs sm:text-sm font-medium transition-all" style="color: var(--accent)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                    <span class="hidden sm:inline">Dashboard</span>
                </button>
                <button onclick="showTab('history')" id="tab-history" class="tab-btn flex flex-col sm:flex-row items-center gap-1 px-5 py-2 rounded-xl text-xs sm:text-sm font-medium transition-all" style="color: var(--text-secondary)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01m-.01 4h.01"/></svg>
                    <span class="hidden sm:inline">History</span>
                </button>
                <button onclick="showTab('timeline')" id="tab-timeline" class="tab-btn flex flex-col sm:flex-row items-center gap-1 px-5 py-2 rounded-xl text-xs sm:text-sm font-medium transition-all" style="color: var(--text-secondary)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                    <span class="hidden sm:inline">Story</span>
                </button>
                <button onclick="showTab('settings')" id="tab-settings" class="tab-btn flex flex-col sm:flex-row items-center gap-1 px-5 py-2 rounded-xl text-xs sm:text-sm font-medium transition-all" style="color: var(--text-secondary)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
                    <span class="hidden sm:inline">Settings</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-4 pb-24 sm:pb-6">
        
        <!-- Prayers from Around the World -->
        <section class="prayers-section rounded-2xl p-4 mb-6">
            <div class="flex items-center justify-between mb-4 relative z-10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-rose-500 flex items-center justify-center shadow-lg">
                        <span class="text-xl prayer-heart">üôè</span>
                    </div>
                    <div>
                        <h2 class="font-bold text-base">Prayers from Around the World</h2>
                        <p class="text-xs" style="color: var(--text-muted)">People who love Sidd & Shagun, praying for Pepper</p>
                    </div>
                </div>
                <div class="globe-icon text-2xl opacity-60">üåç</div>
            </div>

            <div class="prayer-carousel relative z-10">
                <!-- David Hoskins - Florida (HAS PHOTO) -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(0)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <img src="https://sanctuaryclinics.com/wp-content/uploads/2025/10/david-hoskins-1.jpg" alt="David Hoskins" class="prayer-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="avatar-placeholder bg-gradient-to-br from-emerald-400 to-teal-600 hidden">DH</div>
                            <span class="flag-badge">üá∫üá∏</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Dr. David Hoskins</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Florida, USA</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">Founder, Sanctuary Clinics</p>
                        </div>
                    </div>
                </div>
                
                <!-- Art Thomas - Michigan (HAS PHOTO) -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(1)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <img src="https://www.artthomas.org/wp-content/uploads/2022/07/Art-Thomas-Web-2022.jpg" alt="Art Thomas" class="prayer-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="avatar-placeholder bg-gradient-to-br from-sky-400 to-cyan-600 hidden">AT</div>
                            <span class="flag-badge">üá∫üá∏</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Art Thomas</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Michigan, USA</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">Missionary-Evangelist ‚Ä¢ Wildfire Ministries</p>
                        </div>
                    </div>
                </div>

                <!-- Darren - Florida -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(2)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <div class="avatar-placeholder bg-gradient-to-br from-blue-400 to-blue-600 text-white font-bold text-sm">DM</div>
                            <span class="flag-badge">üá∫üá∏</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Darren Michael Shaw</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Florida, USA</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">Author & Brother in Christ</p>
                        </div>
                    </div>
                </div>

                <!-- Chad - Florida -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(3)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <div class="avatar-placeholder bg-gradient-to-br from-amber-400 to-orange-600 text-white font-bold text-sm">CR</div>
                            <span class="flag-badge">üá∫üá∏</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Chad Richard</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Florida, USA</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">CEO, Honey Lake ‚Ä¢ His dog was also Pepper üêï</p>
                        </div>
                    </div>
                </div>

                <!-- Jeremiah - Virginia -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(4)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <div class="avatar-placeholder bg-gradient-to-br from-purple-400 to-indigo-600 text-white font-bold text-sm">J</div>
                            <span class="flag-badge">üá∫üá∏</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Jeremiah</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Virginia, USA</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">Director, Christian Care Connect</p>
                        </div>
                    </div>
                </div>

                <!-- Johnny - Virginia -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(5)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <div class="avatar-placeholder bg-gradient-to-br from-rose-400 to-pink-600 text-white font-bold text-sm">JS</div>
                            <span class="flag-badge">üá∫üá∏</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Johnny Smulik</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Virginia, USA</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">VP Technology, AACC</p>
                        </div>
                    </div>
                </div>

                <!-- Ken & Frieda - India (HAS PHOTO) -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(6)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <img src="ken-frieda.jpg" alt="Ken & Frieda McRae" class="prayer-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="avatar-placeholder bg-gradient-to-br from-orange-400 to-red-600 text-white font-bold text-sm hidden">K&F</div>
                            <span class="flag-badge">üáÆüá≥</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Ken & Frieda McRae</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Selaqui, India</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">Founders, Shishya Society (since 1979)</p>
                        </div>
                    </div>
                </div>
                
                <!-- Leah - Germany (HAS PHOTO) -->
                <div class="prayer-card rounded-xl p-3 min-w-[220px] sm:min-w-[240px] flex-shrink-0" onclick="showPrayerPopup(7)">
                    <div class="flex items-start gap-3">
                        <div class="avatar-container">
                            <img src="leah.jpg" alt="Leah Hohmann" class="prayer-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="avatar-placeholder bg-gradient-to-br from-yellow-400 to-amber-500 text-white font-bold text-sm hidden">LH</div>
                            <span class="flag-badge">üá©üá™</span>
                        </div>
                        <div class="min-w-0">
                            <p class="font-semibold text-sm">Leah Hohmann</p>
                            <p class="text-[10px] mt-0.5" style="color: var(--text-muted)">Germany</p>
                            <p class="text-[10px] mt-1 leading-tight" style="color: var(--text-secondary)">Sister in Christ üíõ</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-center flex-wrap gap-3 mt-4 text-xs relative z-10" style="color: var(--text-muted)">
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                    Florida (3)
                </span>
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                    Virginia (2)
                </span>
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-cyan-500"></span>
                    Michigan (1)
                </span>
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                    Germany (1)
                </span>
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-orange-500"></span>
                    India (2)
                </span>
            </div>
        </section>
        
        <!-- Dashboard Tab -->
        <div id="view-dashboard" class="tab-view">
            
            <!-- News Updates -->
            <div class="mb-8">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-slate-700 to-slate-900 flex items-center justify-center shadow-sm">
                        <span class="text-sm">üì∞</span>
                    </div>
                    <div>
                        <h2 class="text-base font-semibold">Live Updates</h2>
                        <p class="text-[10px] uppercase tracking-wider" style="color: var(--text-muted)">News & Progress</p>
                    </div>
                </div>
                <div id="news-ticker" class="relative overflow-hidden h-20 rounded-xl" style="background: var(--bg-secondary)">
                    <div id="news-updates" class="news-scroll absolute w-full p-2">
                        <!-- Updates will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Section Divider -->
            <div class="flex items-center gap-4 mb-8">
                <div class="flex-1 h-px" style="background: linear-gradient(to right, transparent, var(--border), transparent)"></div>
                <span class="text-[10px] uppercase tracking-widest font-medium" style="color: var(--text-muted)">Medical Data</span>
                <div class="flex-1 h-px" style="background: linear-gradient(to right, transparent, var(--border), transparent)"></div>
            </div>
            
            <!-- Health Status -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-red-500 to-rose-700 flex items-center justify-center shadow-sm">
                            <span class="text-sm">ü©∫</span>
                        </div>
                        <div>
                            <h2 class="text-base font-semibold">Health Report</h2>
                            <p class="text-[10px] uppercase tracking-wider" style="color: var(--text-muted)">Latest Lab Values</p>
                        </div>
                    </div>
                    <div id="last-weight" class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary); color: var(--text-muted)"></div>
                </div>
                <div id="status-badges" class="flex flex-wrap gap-2 mt-3">
                    <span class="text-sm" style="color: var(--text-muted)">No reports yet. Add your first lab report!</span>
                </div>
            </div>

            <!-- Section Divider -->
            <div class="flex items-center gap-4 mb-6 mt-8">
                <div class="flex-1 h-px" style="background: linear-gradient(to right, transparent, var(--border), transparent)"></div>
                <span class="text-[10px] uppercase tracking-widest font-medium" style="color: var(--text-muted)">Trends & Charts</span>
                <div class="flex-1 h-px" style="background: linear-gradient(to right, transparent, var(--border), transparent)"></div>
            </div>
            
            <!-- Filters -->
            <div class="flex flex-col gap-3 mb-6">
                <input type="text" id="search-filter" placeholder="üîç Search lab values..." 
                    class="w-full px-4 py-3 rounded-xl text-sm">
                <div class="flex gap-2">
                    <button onclick="setFilter('all')" id="filter-all" class="filter-btn flex-1 px-4 py-3 rounded-xl btn-primary text-sm font-medium">All Values</button>
                    <button onclick="setFilter('flagged')" id="filter-flagged" class="filter-btn flex-1 px-4 py-3 rounded-xl text-sm font-medium" style="background: var(--bg-secondary); color: var(--text-secondary)">üî¥ Flagged</button>
                </div>
            </div>

            <!-- Charts Grid -->
            <div id="charts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="text-center py-16 col-span-full" style="color: var(--text-muted)">
                    <p class="text-5xl mb-4 opacity-50">üìä</p>
                    <p class="text-lg">Charts will appear here after you add lab reports</p>
                    <button onclick="showTab('add')" class="mt-4 px-6 py-2 btn-primary rounded-xl text-sm font-medium">Add First Report</button>
                </div>
            </div>
        </div>

        <!-- Add Report Tab -->
        <div id="view-add" class="tab-view hidden">
            <div class="max-w-2xl mx-auto">
                <div class="card rounded-2xl card-shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">Add Lab Report</h2>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--text-secondary)">Report Date</label>
                            <input type="date" id="report-date" class="w-full px-4 py-3 rounded-xl text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--text-secondary)">Weight (kg)</label>
                            <input type="number" step="0.1" id="report-weight" placeholder="e.g., 25.5" class="w-full px-4 py-3 rounded-xl text-sm">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" style="color: var(--text-secondary)">Paste Lab Report Text</label>
                        <textarea id="report-text" rows="8" placeholder="Paste the full lab report here...

Example formats:
WBC: 12.5 (6.0-17.0 x10^9/L)
RBC: 6.8 (5.5-8.5 x10^12/L)
BUN: 25 (7-27 mg/dL)
Creatinine: 1.4 (0.5-1.8 mg/dL)
..."
                            class="w-full px-4 py-3 rounded-xl text-sm"></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" style="color: var(--text-secondary)">Vet Notes (optional)</label>
                        <textarea id="report-notes" rows="3" placeholder="Any observations from this visit..."
                            class="w-full px-4 py-3 rounded-xl text-sm"></textarea>
                    </div>

                    <button onclick="parseAndSaveReport()" class="w-full py-3 btn-primary rounded-xl font-semibold">
                        Parse & Preview
                    </button>
                </div>

                <!-- Parsed Preview -->
                <div id="parsed-preview" class="mt-6 hidden">
                    <div class="card rounded-2xl card-shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Parsed Values</h3>
                            <span id="parsed-count" class="text-sm px-3 py-1 rounded-full" style="background: var(--accent-light); color: var(--accent)">0 values</span>
                        </div>
                        <div id="parsed-values" class="space-y-2 max-h-80 overflow-y-auto"></div>
                        <button onclick="confirmSave()" class="w-full mt-4 py-3 rounded-xl font-semibold text-white" style="background: #333333">
                            ‚úì Confirm & Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weight Tab -->
        <div id="view-weight" class="tab-view hidden">
            <div class="max-w-2xl mx-auto">
                <div class="card rounded-2xl card-shadow p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Weight Tracking</h2>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="weight-chart"></canvas>
                    </div>
                </div>
                
                <div class="card rounded-2xl card-shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">Add Weight Entry</h3>
                    <div class="flex gap-4">
                        <input type="date" id="weight-date" class="flex-1 px-4 py-3 rounded-xl text-sm">
                        <input type="number" step="0.1" id="weight-value" placeholder="Weight (kg)" class="w-32 px-4 py-3 rounded-xl text-sm">
                        <button onclick="addWeight()" class="px-6 py-3 btn-primary rounded-xl font-medium">Add</button>
                    </div>
                    <div id="weight-history" class="mt-4 space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="view-history" class="tab-view hidden">
            <div class="max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Report History</h2>
                    <button onclick="exportPDF()" class="px-4 py-2 rounded-xl text-sm font-medium" style="background: var(--bg-secondary)">üìÑ Export PDF</button>
                </div>
                <div id="history-list" class="space-y-4">
                    <p class="text-center py-12" style="color: var(--text-muted)">No reports saved yet.</p>
                </div>
            </div>
        </div>

        <!-- Timeline/Story Tab -->
        <div id="view-timeline" class="tab-view hidden">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold mb-2">Pepper's Story</h2>
                <p class="text-sm mb-6" style="color: var(--text-muted)">Clinical timeline for veterinary reference</p>

                <!-- Timeline -->
                <div class="space-y-4">
                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #6b7280;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary)">Early Jan</span>
                            <span class="font-semibold">Initial Presentation</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)">Stopped eating. Labs showed <strong>mild SGOT/SGPT elevation</strong>. Vitamin D deficient. Low calcium and albumin noted.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #f59e0b;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary)">Jan 23</span>
                            <span class="font-semibold">Pyometra & Surgery</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)">USG diagnosed <strong>pyometra</strong>. Emergency spay performed same evening. Histopathology found <strong>benign granulosa cell tumor</strong> in ovary. Post-op: eating but <strong>respiratory rate elevated</strong> and stayed high.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #ef4444;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: #fee2e2; color: #ef4444;">Feb 4</span>
                            <span class="font-semibold">Liver Crisis</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)"><strong>Jaundice developed.</strong> Bilirubin 3.47 (5x normal). ALT 529, AST 270 ‚Äî severe liver stress. Albumin critically low at 1.90.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #555555;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary)">Feb 4-7</span>
                            <span class="font-semibold">Treatment Response</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)">Started <strong>Amoxirum + D5</strong>. Good response ‚Äî bilirubin normalized (0.39), AST normalized (52.7), ALT improving. However, WBC elevated (43.89) indicating ongoing inflammation.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #f59e0b;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary)">Feb 12</span>
                            <span class="font-semibold">Setback</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)">Treatment stopped. <strong>ALT spiked to 599</strong> ‚Äî highest recorded. Liver struggling again.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #8b5cf6;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary)">Feb 15</span>
                            <span class="font-semibold">Treatment Change</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)">Jaundice returned. <strong>Meropenem started</strong> (broad-spectrum antibiotic). ALT down to 431. ALP climbing (586). NT-proBNP normal ‚Äî heart okay. Showed improvement, eating again.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #f59e0b;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: var(--bg-secondary)">Feb 21</span>
                            <span class="font-semibold">ALP Peak</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)"><strong>ALP hit 1,026</strong> (9x normal). Bilirubin elevated again (1.60). Severe protein wasting ‚Äî albumin 1.74, total protein 4.80. Tick fever PCR negative. Pancreatic lipase normal.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #ef4444;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: #fee2e2; color: #ef4444;">Feb 24</span>
                            <span class="font-semibold">Anemia & Thrombocytopenia</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)"><strong>New crisis:</strong> HGB 9.3, RBC 3.87, PCV 24.8% ‚Äî severe anemia. Platelets crashed to 73 ‚Äî thrombocytopenia. WBC 69.8. Total protein critically low at 3.48. Started <strong>plasma transfusions + erythopoietin</strong>.</p>
                    </div>

                    <div class="card rounded-2xl card-shadow p-4 border-l-4" style="border-color: #ef4444;">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xs px-2 py-1 rounded-full" style="background: #fee2e2; color: #ef4444;">Feb 26-27</span>
                            <span class="font-semibold">Current Status</span>
                        </div>
                        <p class="text-sm" style="color: var(--text-secondary)">Anemia worsening: <strong>HGB 8.1</strong>, RBC 3.50, PCV 23%. Platelets 64. WBC 86.7 (extreme). On daily IV fluids, plasma, erythopoietin, meropenem. <strong>RR better in mornings</strong> (cyclic). Appetite fluctuates. Energy declining past 4 days. <strong>New: Burping √ó 2 days, mild coughing √ó 1 day.</strong></p>
                    </div>
                </div>

                <!-- Current Treatment -->
                <div class="card rounded-2xl card-shadow p-4 mt-6" style="background: linear-gradient(135deg, var(--accent-light), var(--bg-secondary));">
                    <h3 class="font-semibold mb-3">Current Treatment Protocol</h3>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: var(--bg-card);">üíâ IV Fluids (daily)</span>
                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: var(--bg-card);">üíä Meropenem</span>
                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: var(--bg-card);">ü©∏ Erythopoietin</span>
                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: var(--bg-card);">ü©∏ Plasma transfusions</span>
                        <span class="px-3 py-1 rounded-full text-xs font-medium" style="background: var(--bg-card);">üíö Livpural</span>
                    </div>
                </div>

                <!-- Key Concerns -->
                <div class="card rounded-2xl card-shadow p-4 mt-4">
                    <h3 class="font-semibold mb-3 text-red-500">‚ö†Ô∏è Key Concerns</h3>
                    <ul class="text-sm space-y-2" style="color: var(--text-secondary);">
                        <li>‚Ä¢ <strong>Progressive anemia</strong> ‚Äî HGB: 11.6 ‚Üí 8.1</li>
                        <li>‚Ä¢ <strong>Severe thrombocytopenia</strong> ‚Äî Platelets: 225 ‚Üí 64</li>
                        <li>‚Ä¢ <strong>Extreme leukocytosis</strong> ‚Äî WBC: 43.9 ‚Üí 86.7</li>
                        <li>‚Ä¢ <strong>Persistent liver stress</strong> ‚Äî ALP >1000</li>
                        <li>‚Ä¢ <strong>Protein wasting</strong> ‚Äî Total protein: 5.75 ‚Üí 3.48</li>
                        <li>‚Ä¢ <strong>Hypocalcemia</strong> ‚Äî Ca persistently 7.4-7.8</li>
                    </ul>
                </div>

                <!-- Positive Signs -->
                <div class="card rounded-2xl card-shadow p-4 mt-4">
                    <h3 class="font-semibold mb-3" style="color: var(--accent);">‚úÖ Positive Signs</h3>
                    <ul class="text-sm space-y-2" style="color: var(--text-secondary);">
                        <li>‚Ä¢ Kidney function normal (creatinine, BUN in range)</li>
                        <li>‚Ä¢ Cardiac function normal (NT-proBNP negative)</li>
                        <li>‚Ä¢ No tick-borne disease (PCR negative)</li>
                        <li>‚Ä¢ No pancreatitis (lipase normal)</li>
                        <li>‚Ä¢ Appetite present intermittently</li>
                        <li>‚Ä¢ Still fighting üí™</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="view-settings" class="tab-view hidden">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold mb-6">Settings & Data</h2>
                
                <div class="card rounded-2xl card-shadow p-6 mb-4">
                    <h3 class="font-semibold mb-4">Appearance</h3>
                    <div class="flex items-center justify-between">
                        <span>Dark Mode</span>
                        <button onclick="toggleDarkMode()" class="px-4 py-2 rounded-xl text-sm" style="background: var(--bg-secondary)">
                            <span id="dark-mode-text">Enable</span>
                        </button>
                    </div>
                </div>

                <div class="card rounded-2xl card-shadow p-6">
                    <h3 class="font-semibold mb-4">Data Export</h3>
                    <button onclick="exportData()" class="w-full py-3 rounded-xl text-sm font-medium" style="background: var(--bg-secondary)">
                        üì§ Export JSON
                    </button>
                    <p class="text-xs mt-3" style="color: var(--text-muted)">Download Pepper's lab data as a JSON file for backup.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Prayer Popup Overlay -->
    <div id="prayer-popup-overlay" class="prayer-popup-overlay" onclick="closePrayerPopup()"></div>
    
    <!-- Prayer Popup -->
    <div id="prayer-popup" class="prayer-popup">
        <div id="prayer-popup-content"></div>
        <button onclick="closePrayerPopup()" class="mt-4 text-sm px-4 py-2 rounded-lg" style="background: var(--bg-secondary); color: var(--text-secondary)">Close</button>
    </div>

    <!-- Interpretation Modal -->
    <div id="interpretation-modal" class="fixed inset-0 z-50 hidden flex items-end sm:items-center justify-center" style="background: rgba(0,0,0,0.5)">
        <div class="w-full sm:max-w-lg sm:rounded-2xl rounded-t-2xl max-h-[85vh] overflow-y-auto" style="background: var(--bg-card)">
            <div class="sticky top-0 p-4 border-b flex justify-between items-center" style="background: var(--bg-card); border-color: var(--border)">
                <h3 id="modal-title" class="font-semibold text-lg">Lab Value Details</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full flex items-center justify-center" style="background: var(--bg-secondary)">‚úï</button>
            </div>
            <div id="modal-content" class="p-4"></div>
        </div>
    </div>

    <!-- PDF Export Container (Hidden) -->
    <div id="pdf-content" class="hidden"></div>

    <!-- Footer -->
    <footer class="max-w-6xl mx-auto px-4 py-6 pb-24 sm:pb-6 text-center">
        <p class="text-xs mb-2" style="color: var(--text-muted)">‚ö†Ô∏è This is not veterinary advice. Always consult your veterinarian for medical decisions.</p>
        <p class="text-xs" style="color: var(--text-muted)">Built by <a href="https://siddatwork.com" class="hover:underline" style="color: var(--text-secondary)">siddatwork.com</a></p>
    </footer>

    <script>
        // ===== PRAYER POPUP =====
        const PRAYER_SUPPORTERS = [
            { name: 'Dr. David Hoskins', location: 'Florida, USA', flag: 'üá∫üá∏', role: 'Founder, Sanctuary Clinics', photo: 'https://sanctuaryclinics.com/wp-content/uploads/2025/10/david-hoskins-1.jpg', gradient: 'from-emerald-400 to-teal-600' },
            { name: 'Art Thomas', location: 'Michigan, USA', flag: 'üá∫üá∏', role: 'Missionary-Evangelist, Wildfire Ministries', photo: 'https://www.artthomas.org/wp-content/uploads/2022/07/Art-Thomas-Web-2022.jpg', gradient: 'from-sky-400 to-cyan-600' },
            { name: 'Darren Michael Shaw', location: 'Florida, USA', flag: 'üá∫üá∏', role: 'Author & Brother in Christ', initials: 'DM', gradient: 'from-blue-400 to-blue-600' },
            { name: 'Chad Richard', location: 'Florida, USA', flag: 'üá∫üá∏', role: 'CEO, Honey Lake Clinic ‚Ä¢ His dog was also named Pepper üêï', initials: 'CR', gradient: 'from-amber-400 to-orange-600' },
            { name: 'Jeremiah', location: 'Virginia, USA', flag: 'üá∫üá∏', role: 'Director, Christian Care Connect', initials: 'J', gradient: 'from-purple-400 to-indigo-600' },
            { name: 'Johnny Smulik', location: 'Virginia, USA', flag: 'üá∫üá∏', role: 'VP Technology, AACC', initials: 'JS', gradient: 'from-rose-400 to-pink-600' },
            { name: 'Ken & Frieda McRae', location: 'Selaqui, India', flag: 'üáÆüá≥', role: 'Founders, Shishya Society (since 1979)', photo: 'ken-frieda.jpg', gradient: 'from-orange-400 to-red-600' },
            { name: 'Leah Hohmann', location: 'Germany', flag: 'üá©üá™', role: 'Sister in Christ üíõ', photo: 'leah.jpg', gradient: 'from-yellow-400 to-amber-500' }
        ];
        
        function showPrayerPopup(index) {
            const person = PRAYER_SUPPORTERS[index];
            const popup = document.getElementById('prayer-popup');
            const overlay = document.getElementById('prayer-popup-overlay');
            const content = document.getElementById('prayer-popup-content');
            
            let avatarHtml;
            if (person.photo) {
                avatarHtml = `<img src="${person.photo}" alt="${person.name}" class="prayer-popup-avatar" onerror="this.outerHTML='<div class=\\'prayer-popup-initials bg-gradient-to-br ${person.gradient}\\'>${person.initials || person.name.split(' ').map(n=>n[0]).join('')}</div>'">`;
            } else {
                avatarHtml = `<div class="prayer-popup-initials bg-gradient-to-br ${person.gradient}">${person.initials}</div>`;
            }
            
            content.innerHTML = `
                <div class="prayer-popup-flag">${person.flag}</div>
                ${avatarHtml}
                <h3 class="text-xl font-bold mb-1">${person.name}</h3>
                <p class="text-sm mb-2" style="color: var(--text-muted)">${person.location}</p>
                <p class="text-sm" style="color: var(--text-secondary)">${person.role}</p>
            `;
            
            popup.classList.add('active');
            overlay.classList.add('active');
        }
        
        function closePrayerPopup() {
            document.getElementById('prayer-popup').classList.remove('active');
            document.getElementById('prayer-popup-overlay').classList.remove('active');
        }
        
        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closePrayerPopup();
        });

        // ===== NEWS UPDATES =====
        const NEWS_UPDATES = [
            { date: '2026-02-27', time: '16:30', text: 'üôè Prayer supporters added to dashboard ‚Äî love from Florida, Virginia & India', type: 'info' },
            { date: '2026-02-27', time: '11:00', text: 'üìä Dashboard now live at pepper.ink.gd', type: 'info' },
            { date: '2026-02-26', time: '18:00', text: 'ü©∏ Lab results: HGB 8.1, Platelets 64, WBC 86.7 ‚Äî anemia worsening', type: 'critical' },
            { date: '2026-02-26', time: '10:00', text: 'üíâ Continuing plasma transfusions + erythopoietin', type: 'treatment' },
            { date: '2026-02-24', time: '14:00', text: '‚ö†Ô∏è New crisis: severe anemia & thrombocytopenia detected', type: 'critical' },
            { date: '2026-02-21', time: '12:00', text: 'üìà ALP peaked at 1026 (9x normal)', type: 'warning' },
            { date: '2026-02-15', time: '09:00', text: 'üíä Started Meropenem ‚Äî showing improvement, eating again', type: 'treatment' },
        ];

        function renderNewsUpdates() {
            const container = document.getElementById('news-updates');
            if (!container) return;
            
            const typeStyles = {
                'critical': 'border-l-4 border-red-500 bg-red-50 dark:bg-red-950/30',
                'warning': 'border-l-4 border-amber-500 bg-amber-50 dark:bg-amber-950/30',
                'treatment': 'border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-950/30',
                'positive': 'border-l-4 border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30',
                'info': 'border-l-4 border-gray-400 bg-gray-50 dark:bg-gray-800/50'
            };
            
            // Show 4 items for the ticker rotation
            container.innerHTML = NEWS_UPDATES.slice(0, 4).map(update => {
                const style = typeStyles[update.type] || typeStyles.info;
                const date = new Date(update.date + 'T' + update.time);
                const timeAgo = getTimeAgo(date);
                
                return `
                    <div class="news-item">
                        <div class="p-3 rounded-xl w-full ${style}" style="background: var(--bg-card)">
                            <p class="text-sm leading-snug" style="color: var(--text-primary)">${update.text}</p>
                            <p class="text-[10px] mt-1.5 font-medium" style="color: var(--text-muted)">${formatDateShort(update.date)} ‚Ä¢ ${update.time} ‚Ä¢ ${timeAgo}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays === 1) return 'yesterday';
            if (diffDays < 7) return `${diffDays}d ago`;
            return `${Math.floor(diffDays / 7)}w ago`;
        }
        
        function formatDateShort(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        // ===== DARK MODE =====
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('pepper_dark_mode', isDark);
            updateDarkModeUI(isDark);
            // Re-render charts with new colors
            renderDashboard();
            renderWeightChart();
        }
        
        function updateDarkModeUI(isDark) {
            document.getElementById('dark-icon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            const darkModeText = document.getElementById('dark-mode-text');
            if (darkModeText) darkModeText.textContent = isDark ? 'Disable' : 'Enable';
        }
        
        // Init dark mode
        if (localStorage.getItem('pepper_dark_mode') === 'true') {
            document.documentElement.classList.add('dark');
            updateDarkModeUI(true);
        }

        // ===== DATA STORAGE =====
        const STORAGE_KEY = 'pepper_health_data';
        
        function getData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : { reports: [], values: {}, weights: [] };
        }
        
        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // ===== EXPORT/IMPORT =====
        function exportData() {
            const data = getData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pepper-health-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.reports && data.values) {
                        saveData(data);
                        alert('Data imported successfully!');
                        renderDashboard();
                        renderWeightChart();
                    } else {
                        alert('Invalid data format');
                    }
                } catch (err) {
                    alert('Error reading file');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Are you sure? This will delete ALL your data permanently.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // ===== PDF EXPORT =====
        function exportPDF() {
            const data = getData();
            if (data.reports.length === 0) {
                alert('No reports to export');
                return;
            }

            const container = document.getElementById('pdf-content');
            const latestReport = data.reports[data.reports.length - 1];
            
            let html = `
                <div style="font-family: Inter, sans-serif; padding: 20px; max-width: 800px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="font-size: 24px; margin: 0;">üêï Pepper's Health Summary</h1>
                        <p style="color: #666; margin-top: 8px;">Generated ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <h2 style="font-size: 18px; border-bottom: 2px solid #333333; padding-bottom: 8px;">Latest Values (${latestReport.date})</h2>
                    <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
                        <tr style="background: #f5f5f5;">
                            <th style="text-align: left; padding: 8px; border: 1px solid #ddd;">Value</th>
                            <th style="text-align: center; padding: 8px; border: 1px solid #ddd;">Result</th>
                            <th style="text-align: center; padding: 8px; border: 1px solid #ddd;">Reference</th>
                            <th style="text-align: center; padding: 8px; border: 1px solid #ddd;">Status</th>
                        </tr>
            `;

            for (const [key, val] of Object.entries(data.values)) {
                const latest = val.readings[val.readings.length - 1];
                const ref = LAB_REFERENCES[key];
                let status = '‚úÖ Normal';
                let statusColor = '#333333';
                
                if (ref) {
                    if (latest.value < ref.low) {
                        status = 'üîª Low';
                        statusColor = '#ef4444';
                    } else if (latest.value > ref.high) {
                        status = 'üî∫ High';
                        statusColor = '#ef4444';
                    }
                }

                html += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${val.name}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #ddd; font-weight: bold;">${latest.value} ${val.unit}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #ddd; color: #666;">${ref ? `${ref.low} - ${ref.high}` : '-'}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #ddd; color: ${statusColor}">${status}</td>
                    </tr>
                `;
            }

            html += `
                    </table>
                    
                    ${data.weights.length > 0 ? `
                    <h2 style="font-size: 18px; border-bottom: 2px solid #333333; padding-bottom: 8px; margin-top: 30px;">Weight History</h2>
                    <p>Latest: <strong>${data.weights[data.weights.length-1].value} kg</strong> (${data.weights[data.weights.length-1].date})</p>
                    ` : ''}
                    
                    <div style="margin-top: 40px; padding: 16px; background: #fff3cd; border-radius: 8px;">
                        <p style="margin: 0; font-size: 12px; color: #856404;">‚ö†Ô∏è This summary is for reference only. Always consult your veterinarian for medical decisions.</p>
                    </div>
                    
                    <p style="text-align: center; margin-top: 30px; font-size: 11px; color: #999;">Generated by Pepper Health Dashboard ‚Ä¢ SIDDATWORK¬Æ</p>
                </div>
            `;

            container.innerHTML = html;
            container.classList.remove('hidden');

            html2pdf().set({
                margin: 10,
                filename: `pepper-health-${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).from(container).save().then(() => {
                container.classList.add('hidden');
            });
        }

        // ===== VETERINARY REFERENCE DATA =====
        const LAB_REFERENCES = {
            // CBC
            'wbc': { name: 'White Blood Cells', unit: 'x10‚Åπ/L', low: 6.0, high: 17.0, category: 'CBC',
                desc: 'White blood cells fight infection and are part of the immune system.',
                highMeaning: 'Elevated WBC may indicate infection, inflammation, stress, or rarely leukemia.',
                lowMeaning: 'Low WBC can indicate bone marrow problems, severe infection, or immune suppression.' },
            'rbc': { name: 'Red Blood Cells', unit: 'x10¬π¬≤/L', low: 5.5, high: 8.5, category: 'CBC',
                desc: 'Red blood cells carry oxygen throughout the body.',
                highMeaning: 'High RBC may indicate dehydration or polycythemia.',
                lowMeaning: 'Low RBC indicates anemia ‚Äî may be from blood loss, destruction, or poor production.' },
            'hemoglobin': { name: 'Hemoglobin', unit: 'g/dL', low: 12, high: 18, category: 'CBC',
                desc: 'The oxygen-carrying protein in red blood cells.',
                highMeaning: 'High hemoglobin often accompanies high RBC ‚Äî usually dehydration.',
                lowMeaning: 'Low hemoglobin means reduced oxygen-carrying capacity (anemia).' },
            'hematocrit': { name: 'Hematocrit (PCV)', unit: '%', low: 37, high: 55, category: 'CBC',
                desc: 'The percentage of blood volume that is red blood cells.',
                highMeaning: 'High PCV suggests dehydration or polycythemia.',
                lowMeaning: 'Low PCV indicates anemia.' },
            'pcv': { name: 'Packed Cell Volume', unit: '%', low: 37, high: 55, category: 'CBC',
                desc: 'Same as hematocrit ‚Äî percentage of red cells in blood.',
                highMeaning: 'Elevated PCV often means dehydration.',
                lowMeaning: 'Low PCV indicates anemia.' },
            'mcv': { name: 'Mean Corpuscular Volume', unit: 'fL', low: 60, high: 77, category: 'CBC',
                desc: 'Average size of red blood cells.',
                highMeaning: 'Large RBCs may indicate regenerative anemia or vitamin deficiency.',
                lowMeaning: 'Small RBCs may indicate iron deficiency.' },
            'mch': { name: 'Mean Corpuscular Hemoglobin', unit: 'pg', low: 19, high: 25, category: 'CBC',
                desc: 'Average amount of hemoglobin per red blood cell.',
                highMeaning: 'May indicate macrocytic anemia.',
                lowMeaning: 'May indicate iron deficiency.' },
            'mchc': { name: 'MCHC', unit: 'g/dL', low: 32, high: 36, category: 'CBC',
                desc: 'Average concentration of hemoglobin in red cells.',
                highMeaning: 'Rare ‚Äî may indicate hereditary spherocytosis.',
                lowMeaning: 'May indicate iron deficiency or chronic disease.' },
            'platelets': { name: 'Platelets', unit: 'x10‚Åπ/L', low: 175, high: 500, category: 'CBC',
                desc: 'Platelets help blood clot to stop bleeding.',
                highMeaning: 'High platelets may indicate inflammation, infection, or iron deficiency.',
                lowMeaning: 'Low platelets increase bleeding risk ‚Äî may indicate immune destruction or bone marrow issues.' },
            'reticulocytes': { name: 'Reticulocytes', unit: '%', low: 0, high: 1.5, category: 'CBC',
                desc: 'Young red blood cells ‚Äî indicates bone marrow activity.',
                highMeaning: 'High reticulocytes show the body is actively making new RBCs (regenerative response).',
                lowMeaning: 'Low with anemia suggests bone marrow isn\'t responding properly.' },
            'neutrophils': { name: 'Neutrophils', unit: 'x10‚Åπ/L', low: 3.0, high: 11.5, category: 'CBC',
                desc: 'Most common white blood cell ‚Äî first responders to infection.',
                highMeaning: 'High neutrophils suggest bacterial infection, inflammation, or stress.',
                lowMeaning: 'Low neutrophils increase infection risk.' },
            'lymphocytes': { name: 'Lymphocytes', unit: 'x10‚Åπ/L', low: 1.0, high: 4.8, category: 'CBC',
                desc: 'White blood cells that fight viruses and produce antibodies.',
                highMeaning: 'High lymphocytes may indicate viral infection or leukemia.',
                lowMeaning: 'Low lymphocytes may indicate stress or immune suppression.' },
            'monocytes': { name: 'Monocytes', unit: 'x10‚Åπ/L', low: 0.1, high: 1.4, category: 'CBC',
                desc: 'White blood cells that clean up dead cells and fight infection.',
                highMeaning: 'High monocytes may indicate chronic infection or inflammation.',
                lowMeaning: 'Low monocytes are usually not significant.' },
            'eosinophils': { name: 'Eosinophils', unit: 'x10‚Åπ/L', low: 0.1, high: 1.2, category: 'CBC',
                desc: 'White blood cells that fight parasites and allergies.',
                highMeaning: 'High eosinophils suggest parasites, allergies, or skin disease.',
                lowMeaning: 'Low eosinophils are usually not significant.' },
            'basophils': { name: 'Basophils', unit: 'x10‚Åπ/L', low: 0, high: 0.1, category: 'CBC',
                desc: 'Rare white blood cells involved in allergic reactions.',
                highMeaning: 'High basophils are rare ‚Äî may indicate allergic reaction.',
                lowMeaning: 'Low/absent basophils are normal.' },

            // Kidney
            'bun': { name: 'Blood Urea Nitrogen', unit: 'mg/dL', low: 7, high: 27, category: 'Kidney',
                desc: 'A waste product filtered by the kidneys.',
                highMeaning: 'High BUN may indicate kidney disease, dehydration, high-protein diet, or GI bleeding.',
                lowMeaning: 'Low BUN is usually not concerning ‚Äî may indicate low protein diet or liver disease.' },
            'creatinine': { name: 'Creatinine', unit: 'mg/dL', low: 0.5, high: 1.8, category: 'Kidney',
                desc: 'A muscle waste product filtered by kidneys ‚Äî best indicator of kidney function.',
                highMeaning: 'High creatinine strongly suggests reduced kidney function.',
                lowMeaning: 'Low creatinine may indicate muscle wasting.' },
            'sdma': { name: 'SDMA', unit: 'Œºg/dL', low: 0, high: 14, category: 'Kidney',
                desc: 'An early kidney disease marker that can detect problems before creatinine rises.',
                highMeaning: 'Elevated SDMA can detect kidney disease earlier than creatinine.',
                lowMeaning: 'Low/normal SDMA is good ‚Äî kidneys are filtering well.' },
            'phosphorus': { name: 'Phosphorus', unit: 'mg/dL', low: 2.5, high: 6.8, category: 'Kidney',
                desc: 'A mineral important for bones ‚Äî kidneys regulate levels.',
                highMeaning: 'High phosphorus often indicates kidney disease or parathyroid issues.',
                lowMeaning: 'Low phosphorus may indicate malnutrition.' },

            // Liver
            'alt': { name: 'ALT (SGPT)', unit: 'U/L', low: 10, high: 125, category: 'Liver',
                desc: 'An enzyme released when liver cells are damaged.',
                highMeaning: 'Elevated ALT indicates liver cell damage ‚Äî could be hepatitis, toxins, or other issues.',
                lowMeaning: 'Low ALT is normal.' },
            'ast': { name: 'AST (SGOT)', unit: 'U/L', low: 0, high: 50, category: 'Liver',
                desc: 'An enzyme found in liver and muscle.',
                highMeaning: 'High AST may indicate liver or muscle damage.',
                lowMeaning: 'Low AST is normal.' },
            'alp': { name: 'Alkaline Phosphatase', unit: 'U/L', low: 23, high: 212, category: 'Liver',
                desc: 'An enzyme from liver, bone, and intestines.',
                highMeaning: 'High ALP may indicate liver disease, bone growth, or Cushing\'s disease.',
                lowMeaning: 'Low ALP is usually not significant.' },
            'ggt': { name: 'GGT', unit: 'U/L', low: 0, high: 11, category: 'Liver',
                desc: 'An enzyme that helps identify bile duct issues.',
                highMeaning: 'High GGT suggests bile duct obstruction or liver disease.',
                lowMeaning: 'Low GGT is normal.' },
            'bilirubin': { name: 'Bilirubin', unit: 'mg/dL', low: 0, high: 0.9, category: 'Liver',
                desc: 'A yellow pigment from red blood cell breakdown.',
                highMeaning: 'High bilirubin causes jaundice ‚Äî may indicate liver disease or hemolysis.',
                lowMeaning: 'Low bilirubin is normal.' },
            'albumin': { name: 'Albumin', unit: 'g/dL', low: 2.3, high: 4.0, category: 'Liver',
                desc: 'A protein made by the liver for fluid balance.',
                highMeaning: 'High albumin usually indicates dehydration.',
                lowMeaning: 'Low albumin may indicate liver disease, kidney loss, or malnutrition.' },
            'globulin': { name: 'Globulin', unit: 'g/dL', low: 2.5, high: 4.5, category: 'Protein',
                desc: 'Proteins including antibodies.',
                highMeaning: 'High globulin may indicate chronic infection or inflammation.',
                lowMeaning: 'Low globulin may indicate immune deficiency.' },
            'totalprotein': { name: 'Total Protein', unit: 'g/dL', low: 5.2, high: 8.2, category: 'Protein',
                desc: 'Sum of albumin and globulin.',
                highMeaning: 'High protein may indicate dehydration or chronic inflammation.',
                lowMeaning: 'Low protein may indicate malnutrition or organ disease.' },

            // Metabolic
            'glucose': { name: 'Glucose', unit: 'mg/dL', low: 74, high: 143, category: 'Metabolic',
                desc: 'Blood sugar ‚Äî the body\'s main energy source.',
                highMeaning: 'High glucose may indicate diabetes or stress response.',
                lowMeaning: 'Low glucose can cause weakness or seizures ‚Äî may indicate insulin issues.' },
            'amylase': { name: 'Amylase', unit: 'U/L', low: 500, high: 1500, category: 'Pancreas',
                desc: 'A digestive enzyme from the pancreas.',
                highMeaning: 'High amylase may indicate pancreatitis.',
                lowMeaning: 'Low amylase is usually not significant.' },
            'lipase': { name: 'Lipase', unit: 'U/L', low: 200, high: 1800, category: 'Pancreas',
                desc: 'A fat-digesting enzyme from the pancreas.',
                highMeaning: 'High lipase may indicate pancreatitis.',
                lowMeaning: 'Low lipase is usually not significant.' },
            'cholesterol': { name: 'Cholesterol', unit: 'mg/dL', low: 110, high: 320, category: 'Metabolic',
                desc: 'A fat used for cell membranes and hormones.',
                highMeaning: 'High cholesterol may indicate hypothyroidism or diabetes.',
                lowMeaning: 'Low cholesterol may indicate malabsorption.' },
            'triglycerides': { name: 'Triglycerides', unit: 'mg/dL', low: 50, high: 150, category: 'Metabolic',
                desc: 'Fats from food.',
                highMeaning: 'High triglycerides may indicate recent meal or diabetes.',
                lowMeaning: 'Low triglycerides are usually not concerning.' },

            // Electrolytes
            'sodium': { name: 'Sodium', unit: 'mEq/L', low: 144, high: 160, category: 'Electrolytes',
                desc: 'An electrolyte for fluid balance and nerve function.',
                highMeaning: 'High sodium may indicate dehydration.',
                lowMeaning: 'Low sodium may indicate kidney disease or Addison\'s.' },
            'potassium': { name: 'Potassium', unit: 'mEq/L', low: 3.5, high: 5.8, category: 'Electrolytes',
                desc: 'An electrolyte vital for heart and muscle function.',
                highMeaning: 'High potassium is dangerous for the heart ‚Äî may indicate kidney disease.',
                lowMeaning: 'Low potassium may cause weakness.' },
            'chloride': { name: 'Chloride', unit: 'mEq/L', low: 109, high: 122, category: 'Electrolytes',
                desc: 'An electrolyte for acid-base balance.',
                highMeaning: 'High chloride may indicate dehydration.',
                lowMeaning: 'Low chloride may indicate vomiting.' },
            'calcium': { name: 'Calcium', unit: 'mg/dL', low: 7.9, high: 12.0, category: 'Electrolytes',
                desc: 'Important for bones, muscles, and nerves.',
                highMeaning: 'High calcium may indicate cancer or kidney disease.',
                lowMeaning: 'Low calcium may cause tremors.' },

            // Thyroid
            't4': { name: 'T4 (Thyroxine)', unit: 'Œºg/dL', low: 1.0, high: 4.0, category: 'Thyroid',
                desc: 'The main thyroid hormone ‚Äî controls metabolism.',
                highMeaning: 'High T4 is rare in dogs.',
                lowMeaning: 'Low T4 may indicate hypothyroidism.' },

            // Urinalysis
            'usg': { name: 'Urine Specific Gravity', unit: '', low: 1.015, high: 1.045, category: 'Urinalysis',
                desc: 'Measures how concentrated the urine is.',
                highMeaning: 'Very concentrated ‚Äî may indicate dehydration.',
                lowMeaning: 'Dilute urine may indicate kidney disease.' },
        };

        // Aliases
        const VALUE_ALIASES = {
            'white blood cells': 'wbc', 'white blood cell': 'wbc', 'leucocytes': 'wbc', 'leukocytes': 'wbc',
            'red blood cells': 'rbc', 'red blood cell': 'rbc', 'erythrocytes': 'rbc',
            'hgb': 'hemoglobin', 'hb': 'hemoglobin',
            'hct': 'hematocrit', 'packed cell volume': 'pcv',
            'plt': 'platelets', 'thrombocytes': 'platelets', 'platelet count': 'platelets',
            'blood urea nitrogen': 'bun', 'urea': 'bun',
            'creat': 'creatinine',
            'sgpt': 'alt', 'alanine aminotransferase': 'alt',
            'sgot': 'ast', 'aspartate aminotransferase': 'ast',
            'alkaline phosphatase': 'alp', 'alk phos': 'alp', 'alkp': 'alp',
            'total bilirubin': 'bilirubin', 'tbil': 'bilirubin',
            'alb': 'albumin', 'glob': 'globulin', 'tp': 'totalprotein', 'total protein': 'totalprotein',
            'glu': 'glucose', 'blood sugar': 'glucose', 'blood glucose': 'glucose',
            'na': 'sodium', 'k': 'potassium', 'cl': 'chloride', 'ca': 'calcium',
            'neut': 'neutrophils', 'lymph': 'lymphocytes', 'mono': 'monocytes', 'eos': 'eosinophils', 'baso': 'basophils',
            'retic': 'reticulocytes', 'retics': 'reticulocytes',
            'thyroxine': 't4', 'free t4': 't4',
            'specific gravity': 'usg', 'sp gr': 'usg', 'sg': 'usg',
        };

        // ===== PARSING =====
        let pendingValues = [];
        let pendingNotes = '';
        let pendingWeight = null;

        function normalizeKey(text) {
            const lower = text.toLowerCase().trim();
            if (LAB_REFERENCES[lower]) return lower;
            if (VALUE_ALIASES[lower]) return VALUE_ALIASES[lower];
            for (const alias in VALUE_ALIASES) {
                if (lower.includes(alias)) return VALUE_ALIASES[alias];
            }
            for (const key in LAB_REFERENCES) {
                if (lower.includes(key) || lower.includes(LAB_REFERENCES[key].name.toLowerCase())) return key;
            }
            return lower.replace(/[^a-z0-9]/g, '');
        }

        function parseLabReport(text) {
            const results = [];
            const lines = text.split('\n');
            
            const patterns = [
                /^(.+?):\s*([\d.]+)\s*(?:\(?([\d.]+)\s*[-‚Äì]\s*([\d.]+)\)?)?[\s]*([a-zA-Z%\/\^Œº¬µ‚Åπ¬π¬≤¬≥‚Å∞\*]+)?/i,
                /^(.+?)\s+([\d.]+)\s+([a-zA-Z%\/\^Œº¬µ‚Åπ¬π¬≤¬≥‚Å∞\*]+)?\s*(?:\(?([\d.]+)\s*[-‚Äì]\s*([\d.]+)\)?)?/i,
                /(.+?)\s*[:\-]\s*([\d.]+)\s*(?:\/\s*[\d.]+)?/i
            ];

            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed || trimmed.length < 3) continue;

                for (const pattern of patterns) {
                    const match = trimmed.match(pattern);
                    if (match) {
                        const name = match[1]?.trim();
                        const value = parseFloat(match[2]);
                        
                        if (name && !isNaN(value) && name.length < 50) {
                            const key = normalizeKey(name);
                            const ref = LAB_REFERENCES[key];
                            
                            // Avoid duplicates
                            if (results.find(r => r.key === key)) continue;
                            
                            results.push({
                                key: key,
                                name: ref?.name || name,
                                value: value,
                                unit: match[5] || match[3] || ref?.unit || '',
                                refLow: parseFloat(match[3]) || parseFloat(match[4]) || ref?.low || null,
                                refHigh: parseFloat(match[4]) || parseFloat(match[5]) || ref?.high || null,
                                category: ref?.category || 'Other',
                                hasReference: !!ref
                            });
                            break;
                        }
                    }
                }
            }
            return results;
        }

        function parseAndSaveReport() {
            const dateInput = document.getElementById('report-date');
            const textInput = document.getElementById('report-text');
            const notesInput = document.getElementById('report-notes');
            const weightInput = document.getElementById('report-weight');
            
            const date = dateInput.value || new Date().toISOString().split('T')[0];
            const text = textInput.value;

            if (!text.trim()) {
                alert('Please paste lab report text');
                return;
            }

            pendingValues = parseLabReport(text);
            pendingValues.forEach(v => v.date = date);
            pendingNotes = notesInput.value;
            pendingWeight = weightInput.value ? parseFloat(weightInput.value) : null;

            if (pendingValues.length === 0) {
                alert('Could not parse any lab values. Try reformatting the text.');
                return;
            }

            const preview = document.getElementById('parsed-preview');
            const container = document.getElementById('parsed-values');
            document.getElementById('parsed-count').textContent = `${pendingValues.length} values`;
            
            container.innerHTML = pendingValues.map((v, i) => {
                const ref = LAB_REFERENCES[v.key];
                let statusClass = 'status-normal';
                let statusIcon = '‚úÖ';
                if (ref) {
                    if (v.value < ref.low) { statusClass = 'status-danger'; statusIcon = 'üîª'; }
                    else if (v.value > ref.high) { statusClass = 'status-danger'; statusIcon = 'üî∫'; }
                }
                return `
                <div class="flex items-center justify-between p-3 rounded-xl" style="background: var(--bg-secondary)">
                    <div class="flex items-center gap-3">
                        <span class="w-8 h-8 rounded-full flex items-center justify-center text-sm ${statusClass}">${statusIcon}</span>
                        <div>
                            <span class="font-medium">${v.name}</span>
                            <span class="font-bold ml-2" style="color: var(--accent)">${v.value}</span>
                            <span class="text-sm" style="color: var(--text-muted)">${v.unit}</span>
                        </div>
                    </div>
                    <button onclick="removePending(${i})" class="text-red-400 hover:text-red-600 p-1">‚úï</button>
                </div>
            `}).join('');
            preview.classList.remove('hidden');
        }

        function removePending(index) {
            pendingValues.splice(index, 1);
            if (pendingValues.length === 0) {
                document.getElementById('parsed-preview').classList.add('hidden');
            } else {
                parseAndSaveReport();
            }
        }

        function confirmSave() {
            if (pendingValues.length === 0) return;

            const data = getData();
            const date = pendingValues[0].date;
            
            const report = {
                id: Date.now(),
                date: date,
                valueCount: pendingValues.length,
                values: pendingValues,
                notes: pendingNotes,
                weight: pendingWeight
            };
            data.reports.push(report);

            // Add weight if provided
            if (pendingWeight) {
                data.weights = data.weights || [];
                data.weights.push({ date: date, value: pendingWeight });
                data.weights.sort((a, b) => new Date(a.date) - new Date(b.date));
            }

            for (const v of pendingValues) {
                if (!data.values[v.key]) {
                    data.values[v.key] = {
                        name: v.name,
                        unit: v.unit,
                        category: v.category,
                        refLow: v.refLow,
                        refHigh: v.refHigh,
                        readings: []
                    };
                }
                data.values[v.key].readings.push({ date: date, value: v.value });
                data.values[v.key].readings.sort((a, b) => new Date(a.date) - new Date(b.date));
            }

            saveData(data);
            
            document.getElementById('parsed-preview').classList.add('hidden');
            document.getElementById('report-text').value = '';
            document.getElementById('report-notes').value = '';
            document.getElementById('report-weight').value = '';
            pendingValues = [];
            
            alert(`Saved ${report.valueCount} lab values!`);
            showTab('dashboard');
            renderDashboard();
        }

        // ===== WEIGHT TRACKING =====
        let weightChart = null;

        function addWeight() {
            const date = document.getElementById('weight-date').value || new Date().toISOString().split('T')[0];
            const value = parseFloat(document.getElementById('weight-value').value);
            
            if (isNaN(value)) {
                alert('Please enter a valid weight');
                return;
            }

            const data = getData();
            data.weights = data.weights || [];
            data.weights.push({ date, value });
            data.weights.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveData(data);
            
            document.getElementById('weight-value').value = '';
            renderWeightChart();
        }

        function renderWeightChart() {
            const data = getData();
            const weights = data.weights || [];
            
            const historyContainer = document.getElementById('weight-history');
            historyContainer.innerHTML = weights.slice().reverse().slice(0, 5).map(w => `
                <div class="flex justify-between items-center p-3 rounded-xl" style="background: var(--bg-secondary)">
                    <span style="color: var(--text-secondary)">${formatDateLong(w.date)}</span>
                    <span class="font-bold">${w.value} kg</span>
                </div>
            `).join('');

            if (weightChart) weightChart.destroy();
            
            const ctx = document.getElementById('weight-chart');
            if (!ctx || weights.length === 0) return;

            const isDark = document.documentElement.classList.contains('dark');
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weights.map(w => formatDate(w.date)),
                    datasets: [{
                        label: 'Weight (kg)',
                        data: weights.map(w => w.value),
                        borderColor: isDark ? '#a3a3a3' : '#262626',
                        backgroundColor: isDark ? 'rgba(163, 163, 163, 0.15)' : 'rgba(160, 160, 160, 0.15)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: isDark ? '#a3a3a3' : '#262626',
                        pointBorderColor: isDark ? '#1a1a1a' : '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: isDark ? '#94a3b8' : '#6b7280' } },
                        y: { grid: { color: isDark ? '#334155' : '#e8e6e1' }, ticks: { color: isDark ? '#94a3b8' : '#6b7280' } }
                    }
                }
            });
        }

        // ===== DASHBOARD =====
        let charts = {};
        let currentFilter = 'all';

        function renderDashboard() {
            const data = getData();
            renderStatusBadges(data);
            renderCharts(data);
            renderHistory(data);
            renderLastWeight(data);
        }

        function renderLastWeight(data) {
            const container = document.getElementById('last-weight');
            const weights = data.weights || [];
            if (weights.length > 0) {
                const latest = weights[weights.length - 1];
                container.innerHTML = `‚öñÔ∏è ${latest.value} kg (${formatDate(latest.date)})`;
            }
        }

        function renderStatusBadges(data) {
            const container = document.getElementById('status-badges');
            const values = Object.entries(data.values);
            
            if (values.length === 0) {
                container.innerHTML = '<span style="color: var(--text-muted)">No reports yet. Add your first lab report!</span>';
                return;
            }

            container.innerHTML = values.map(([key, val]) => {
                const latest = val.readings[val.readings.length - 1];
                const ref = LAB_REFERENCES[key];
                let statusClass = 'status-normal';
                let icon = '‚úÖ';
                
                if (ref) {
                    if (latest.value < ref.low || latest.value > ref.high) {
                        statusClass = 'status-danger';
                        icon = 'üî¥';
                    } else if (latest.value < ref.low * 1.1 || latest.value > ref.high * 0.9) {
                        statusClass = 'status-warning';
                        icon = '‚ö†Ô∏è';
                    }
                }
                
                return `<span class="px-3 py-1.5 rounded-full text-xs font-medium cursor-pointer hover:opacity-80 ${statusClass}" onclick="showInterpretation('${key}')">${icon} ${val.name}</span>`;
            }).join('');
        }

        function renderCharts(data) {
            const container = document.getElementById('charts-grid');
            const searchTerm = document.getElementById('search-filter').value.toLowerCase();
            const values = Object.entries(data.values);

            if (values.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16 col-span-full" style="color: var(--text-muted)">
                        <p class="text-5xl mb-4 opacity-50">üìä</p>
                        <p class="text-lg">Charts will appear here after you add lab reports</p>
                        <button onclick="showTab('add')" class="mt-4 px-6 py-2 btn-primary rounded-xl text-sm font-medium">Add First Report</button>
                    </div>
                `;
                return;
            }

            Object.values(charts).forEach(c => c.destroy());
            charts = {};

            const filteredValues = values.filter(([key, val]) => {
                const ref = LAB_REFERENCES[key];
                const latest = val.readings[val.readings.length - 1];
                
                if (searchTerm && !val.name.toLowerCase().includes(searchTerm)) return false;
                
                if (currentFilter === 'flagged' && ref) {
                    if (latest.value >= ref.low && latest.value <= ref.high) return false;
                }
                
                return true;
            });

            if (filteredValues.length === 0) {
                container.innerHTML = `<div class="text-center py-12 col-span-full" style="color: var(--text-muted)">No matching values found</div>`;
                return;
            }

            container.innerHTML = filteredValues.map(([key, val]) => {
                const latest = val.readings[val.readings.length - 1];
                const ref = LAB_REFERENCES[key];
                let statusClass = '';
                if (ref) {
                    if (latest.value < ref.low || latest.value > ref.high) statusClass = 'border-l-4 border-red-400';
                }
                return `
                <div class="card rounded-2xl card-shadow p-4 slide-up ${statusClass}">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-semibold">${val.name}</h3>
                            <p class="text-xs" style="color: var(--text-muted)">${val.category || 'General'}</p>
                        </div>
                        <button onclick="showInterpretation('${key}')" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">‚ÑπÔ∏è</button>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-${key}"></canvas>
                    </div>
                    <div class="mt-3 text-center">
                        <span class="text-2xl font-bold">${latest.value}</span>
                        <span class="text-sm" style="color: var(--text-muted)">${val.unit}</span>
                    </div>
                </div>
            `}).join('');

            filteredValues.forEach(([key, val]) => createChart(key, val));
        }

        function createChart(key, val) {
            const ctx = document.getElementById(`chart-${key}`);
            if (!ctx) return;

            const ref = LAB_REFERENCES[key];
            const readings = val.readings;
            const isDark = document.documentElement.classList.contains('dark');
            
            charts[key] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: readings.map(r => formatDate(r.date)),
                    datasets: [{
                        label: val.name,
                        data: readings.map(r => r.value),
                        borderColor: isDark ? '#a3a3a3' : '#262626',
                        backgroundColor: isDark ? 'rgba(163, 163, 163, 0.15)' : 'rgba(160, 160, 160, 0.15)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointBackgroundColor: readings.map(r => {
                            if (ref && (r.value < ref.low || r.value > ref.high)) return '#ef4444';
                            return isDark ? '#a3a3a3' : '#404040';
                        }),
                        pointBorderColor: isDark ? '#1a1a1a' : '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: ref ? {
                            annotations: {
                                normalRange: {
                                    type: 'box',
                                    yMin: ref.low,
                                    yMax: ref.high,
                                    backgroundColor: isDark ? 'rgba(160, 160, 160, 0.2)' : 'rgba(160, 160, 160, 0.15)',
                                    borderWidth: 0
                                }
                            }
                        } : {}
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { font: { size: 10 }, color: isDark ? '#64748b' : '#9ca3af' } },
                        y: { grid: { color: isDark ? '#334155' : '#f0f0f0' }, ticks: { font: { size: 10 }, color: isDark ? '#64748b' : '#9ca3af' } }
                    }
                }
            });
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatDateLong(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
        }

        // ===== INTERPRETATION MODAL =====
        function showInterpretation(key) {
            const data = getData();
            const val = data.values[key];
            const ref = LAB_REFERENCES[key];
            const readings = val.readings;
            const latest = readings[readings.length - 1];

            let trend = 'stable';
            let trendIcon = '‚û°Ô∏è';
            if (readings.length >= 2) {
                const prev = readings[readings.length - 2];
                const change = ((latest.value - prev.value) / prev.value) * 100;
                if (change > 10) { trend = 'increasing'; trendIcon = 'üìà'; }
                else if (change < -10) { trend = 'decreasing'; trendIcon = 'üìâ'; }
            }

            let status = 'normal';
            let statusText = 'Within normal range';
            let statusClass = 'status-normal';
            if (ref) {
                if (latest.value < ref.low) {
                    status = 'low'; statusText = `Below normal (ref: ${ref.low})`;
                    statusClass = 'status-danger';
                } else if (latest.value > ref.high) {
                    status = 'high'; statusText = `Above normal (ref: ${ref.high})`;
                    statusClass = 'status-danger';
                }
            }

            document.getElementById('modal-title').textContent = val.name;
            document.getElementById('modal-content').innerHTML = `
                <div class="space-y-4">
                    <div class="text-center p-6 rounded-2xl" style="background: var(--bg-secondary)">
                        <p class="text-4xl font-bold">${latest.value} <span class="text-lg font-normal" style="color: var(--text-muted)">${val.unit}</span></p>
                        <p class="text-sm mt-2" style="color: var(--text-muted)">${formatDateLong(latest.date)}</p>
                    </div>

                    <div class="flex gap-2 flex-wrap">
                        <span class="px-3 py-1.5 rounded-full text-xs font-medium ${statusClass}">${statusText}</span>
                        <span class="px-3 py-1.5 rounded-full text-xs font-medium" style="background: var(--bg-secondary)">${trendIcon} ${trend.charAt(0).toUpperCase() + trend.slice(1)}</span>
                    </div>

                    ${ref ? `
                    <div class="interpretation-card rounded-xl p-4">
                        <h4 class="font-semibold mb-2">What This Measures</h4>
                        <p class="text-sm" style="color: var(--text-secondary)">${ref.desc}</p>
                    </div>

                    ${status !== 'normal' ? `
                    <div class="rounded-xl p-4" style="background: var(--${status === 'high' ? 'danger' : 'warning'}-bg)">
                        <h4 class="font-semibold mb-2" style="color: var(--${status === 'high' ? 'danger' : 'warning'})">What ${status === 'high' ? 'Elevated' : 'Low'} Values May Mean</h4>
                        <p class="text-sm" style="color: var(--text-secondary)">${status === 'high' ? ref.highMeaning : ref.lowMeaning}</p>
                    </div>
                    ` : ''}

                    <div class="rounded-xl p-4" style="background: var(--bg-secondary)">
                        <h4 class="font-semibold mb-2">Reference Range</h4>
                        <p class="text-sm" style="color: var(--text-secondary)">${ref.low} ‚Äì ${ref.high} ${ref.unit}</p>
                    </div>
                    ` : `
                    <div class="rounded-xl p-4" style="background: var(--bg-secondary)">
                        <p class="text-sm" style="color: var(--text-muted)">No reference data available for this value.</p>
                    </div>
                    `}

                    <p class="text-xs text-center" style="color: var(--text-muted)">‚ö†Ô∏è This is not veterinary advice. Always consult your vet.</p>
                </div>
            `;

            document.getElementById('interpretation-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('interpretation-modal').classList.add('hidden');
        }

        // ===== HISTORY =====
        function renderHistory(data) {
            const container = document.getElementById('history-list');
            
            if (data.reports.length === 0) {
                container.innerHTML = '<p class="text-center py-12" style="color: var(--text-muted)">No reports saved yet.</p>';
                return;
            }

            const sorted = [...data.reports].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sorted.map(report => `
                <div class="card rounded-2xl card-shadow p-4">
                    <div class="mb-3">
                        <p class="font-semibold">${formatDateLong(report.date)}</p>
                        <p class="text-sm" style="color: var(--text-muted)">${report.valueCount} values</p>
                    </div>
                    ${report.notes ? `<p class="text-sm mb-3 p-3 rounded-xl" style="background: var(--bg-secondary); color: var(--text-secondary)">üìù ${report.notes}</p>` : ''}
                    <div class="flex flex-wrap gap-1">
                        ${report.values.map(v => {
                            const ref = LAB_REFERENCES[v.key];
                            let color = 'var(--text-secondary)';
                            if (ref && (v.value < ref.low || v.value > ref.high)) color = 'var(--danger)';
                            return `<span class="px-2 py-1 rounded text-xs" style="background: var(--bg-secondary); color: ${color}">${v.name}: ${v.value}</span>`;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function deleteReport(id) {
            if (!confirm('Delete this report? This will remove all values from this date.')) return;
            
            const data = getData();
            const report = data.reports.find(r => r.id === id);
            
            if (report) {
                for (const v of report.values) {
                    if (data.values[v.key]) {
                        data.values[v.key].readings = data.values[v.key].readings.filter(r => r.date !== report.date);
                        if (data.values[v.key].readings.length === 0) delete data.values[v.key];
                    }
                }
                data.reports = data.reports.filter(r => r.id !== id);
            }
            
            saveData(data);
            renderDashboard();
        }

        // ===== NAVIGATION =====
        function showTab(tab) {
            document.querySelectorAll('.tab-view').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.style.color = 'var(--text-secondary)';
                b.style.background = 'transparent';
            });
            
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            const activeBtn = document.getElementById(`tab-${tab}`);
            activeBtn.style.color = 'var(--accent)';
            activeBtn.style.background = 'var(--accent-light)';
            
            if (tab === 'dashboard') renderDashboard();
            if (tab === 'weight') {
                document.getElementById('weight-date').value = new Date().toISOString().split('T')[0];
                renderWeightChart();
            }
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.getElementById('filter-all').className = `filter-btn px-4 py-2 rounded-xl text-sm font-medium ${filter === 'all' ? 'btn-primary' : ''}`;
            document.getElementById('filter-all').style.background = filter === 'all' ? '' : 'var(--bg-secondary)';
            document.getElementById('filter-all').style.color = filter === 'all' ? '' : 'var(--text-secondary)';
            document.getElementById('filter-flagged').className = `filter-btn px-4 py-2 rounded-xl text-sm font-medium ${filter === 'flagged' ? 'btn-primary' : ''}`;
            document.getElementById('filter-flagged').style.background = filter === 'flagged' ? '' : 'var(--bg-secondary)';
            document.getElementById('filter-flagged').style.color = filter === 'flagged' ? '' : 'var(--text-secondary)';
            renderDashboard();
        }

        document.getElementById('search-filter').addEventListener('input', () => renderDashboard());
        document.getElementById('interpretation-modal').addEventListener('click', (e) => {
            if (e.target.id === 'interpretation-modal') closeModal();
        });

        // Auto-load data on first visit
        async function autoLoadData() {
            const data = getData();
            if (data.reports.length === 0) {
                try {
                    const response = await fetch('pepper-data.json');
                    if (response.ok) {
                        const preloadData = await response.json();
                        saveData(preloadData);
                        console.log('‚úÖ Auto-loaded Pepper lab data');
                    }
                } catch (e) {
                    console.log('No preload data');
                }
            }
            renderDashboard();
            renderWeightChart();
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('report-date').value = new Date().toISOString().split('T')[0];
            renderNewsUpdates();
            autoLoadData();
        });
    </script>
</body>
</html>

